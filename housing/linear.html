<!DOCTYPE html>
<html>
<head>
  <title>TensorFlow.js linear regression</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs/dist/tf.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-vis"></script>
</head>
<body>

  <script type="text/javascript">

    const plot = (pointsArray, featureName) => {
      tfvis.render.scatterplot(
        { name: `${featureName} vs House Price`},
        { values: [pointsArray], series: ['original'] },
        {
          xLabel: featureName,
          yLabel: "Price"
        }
      )
    }

    const normalize = (tensor) => {
      const min = tensor.min()
      const max = tensor.max()
      const normalizedTensor = tensor
        .sub(min)
        .div(max
          .sub(min)
        )
      return {
        tensor: normalizedTensor,
        min,
        max,
      }
    }

    const denormalize = (tensor, min, max) => {
      const denormalisedTensor = tensor
        .mul(max
          .sub(min)
        ).add(min);
      return denormalisedTensor;
    }

    const run = async () => {
      // import from csv
      const salesData = tf.data.csv("http://127.0.0.1:8080/housing/kc_house_data.csv");

      // extract points (x and y values) to plot
      const pointsData = salesData.map(record => ({
        x: record.sqft_living,
        y: record.price
      }))
      const points = await pointsData.toArray();

      // ensuring there are an even number of points, for the sake of splitting
      if (points.length % 2 !== 0) {
        points.pop();
      }

      // shuffling the points
      tf.util.shuffle(points);

      // graphing the points
      plot(points, "Square Feet")

      // extract inputs (features)
      // const featureValues = await pointsData.map(p => p.x).toArray()
      const featureValues = points.map(p => p.x)
      const featureTensor = tf.tensor2d(featureValues, [featureValues.length, 1])

      // extract outputs (labels)
      // const labelValues = await pointsData.map(p => p.y).toArray()
      const labelValues = points.map(p => p.y)
      const labelTensor = tf.tensor2d(labelValues, [labelValues.length, 1])

      // normalize features and labels
      const normalizedFeature = normalize(featureTensor)
      const normalizedLabel = normalize(labelTensor)

      // splitting data into training and testing data
      const [trainingFeatureTensor, testingFeatureTensor] = tf.split(normalizedFeature.tensor, 2);
      const [trainingLabelTensor, testingLabelTensor] = tf.split(normalizedLabel.tensor, 2);

      trainingFeatureTensor.print(true)
    }

    run();

  </script>

</body>
</html>
